unit Unit1;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.CustomizeDlg,
  Vcl.ToolWin, Vcl.ActnMan, Vcl.ActnCtrls, Vcl.ActnMenus, Vcl.ActnColorMaps,
  Vcl.Mask, Vcl.ExtCtrls, Vcl.Buttons, Vcl.CheckLst, Vcl.CategoryButtons,
  Vcl.ButtonGroup, Vcl.ComCtrls, Vcl.JumpList, CommCtrl, Data.DB, Vcl.Grids,
  Vcl.DBGrids, Vcl.ControlList, System.ImageList, Vcl.ImgList;

type

  TTeam = record
    Code: Integer; //Код команды
    Name: string;  //Имя команды
    Country: string; //Страна команды
    Rank: Integer;   //Номер команды в турнирной таблице
  end;

  TPlayer = record
    FullName: string; //Полное имя футболиста
    Code: Integer; //Код игрока (эквивалентно выше)
    Position: string;  //Амплуа игрока
    PenaltyPoints: Integer; //Штрафные очки
    GoalsScored: Integer;  //Количество забитых голов или переданных пасов
  end;

  PTeam = ^TTeamNode;
  TTeamNode = Record
    Data: TTeam;
    TeamPlayers: Array [1..11] of TPlayer;
    Next: PTeam;
  end;

  TTeamList = record
    Head: PTeam;
    Tail: PTeam;
  end;
  
  TListView = class(Vcl.ComCtrls.TListView)
  protected
      procedure WndProc(var Message: TMessage); override;
  end;
  
  TMainForm = class(TForm)
    MaskEdit1: TMaskEdit;
    BitBtn1: TBitBtn;
    Bevel1: TBevel;
    ListBox1: TListBox;
    LViewTeam: TListView;
    Label1: TLabel;
    BitBtn3: TBitBtn;
    BitBtn2: TBitBtn;
    PanelAnalysis: TPanel;
    PanelAdd: TPanel;
    ListView2: TListView;
    PanelPlayers: TPanel;
    Label2: TLabel;
    procedure LViewTeamColumnClick(Sender: TObject; Column: TListColumn);
    Procedure InsertInList(Info: TTeamNode);
    procedure LViewTeamSelectItem(Sender: TObject; Item: TListItem;
      Selected: Boolean);
    procedure LViewTeamDblClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure LViewTeamKeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
  private
      FTeamList: TTeamList;
      FListViewOldWndProc: TWndMethod;
      procedure ListViewNewWndProc(var Msg: TMessage);
  public

  end;

var
  MainForm: TMainForm;

implementation

{$R *.dfm}

procedure TMainForm.ListViewNewWndProc(var Msg: TMessage);
var
    hdn: ^THDNotify;
begin
    if Msg.Msg = WM_NOTIFY then
    begin
        hdn := Pointer(Msg.lParam);
        if (hdn.hdr.code = HDN_BeginTrackW) or (hdn.hdr.code = HDN_BeginTrackA) then
            Msg.Result := 1
        else
            FListViewOldWndProc(Msg);
    end 
    else
        FListViewOldWndProc(Msg);
end;

procedure TListView.WndProc(var Message: TMessage);
begin
    If Message.Msg = WM_NCCALCSIZE then
        ShowScrollBar(Handle, SB_HORZ, False);
    Inherited WndProc(Message);
end;

procedure TMainForm.FormCreate(Sender: TObject);
begin
    FListViewOldWndProc := ListView1.WindowProc;
    Listview1.WindowProc := ListViewNewWndProc;
    ListView1.Columns[2].Width := LVSCW_AUTOSIZE_USEHEADER;
end;
    

procedure TMainForm.FormShow(Sender: TObject);
begin
    ListView1.Width := ListView1.Width + 1;
    ListView1.Width := ListView1.Width - 1;
end;

procedure TMainForm.InsertInList(Info: TTeamNode);
Var
    NewNode: PTeam;
begin
    New(NewNode);
    NewNode^.Data := Info.Data;
    NewNode^.TeamPlayers := Info.TeamPlayers;
    NewNode^.Next := nil;
    If FTeamList.Head = nil Then
    Begin
        FTeamList.Head := NewNode;
        FTeamList.Tail := NewNode;
    End
    Else
    Begin
        FTeamList.Tail^.Next := NewNode;
        FTeamList.Tail := FTeamList.Tail^.Next;
    End;
end;

procedure TMainForm.LViewTeamColumnClick(Sender: TObject; Column: TListColumn);
begin
    Var X := Column.Index;
    (Sender as TCustomListView).AlphaSort;
end;

procedure TMainForm.LViewTeamDblClick(Sender: TObject);
var
    Item: TListItem;
begin
    Item := ListView1.Selected;
    if Assigned(Item) and Item.Selected then
    begin
        ShowMessage('Meow');
      // ячейка была выбрана
      // выполнить необходимые действия
    end;
end;

procedure TMainForm.LViewTeamKeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
Var
    X: TListItem;
begin
    If (Key = VK_DELETE) and (ListView1.ItemIndex <> -1) and 
    (MessageBox(MainForm.Handle, 'Вы хотите удалить данную команду?', 'Удаление', MB_YESNO + MB_ICONQUESTION) = ID_YES)Then
        ListView1.Delete(ListView1.Selected);
end;

procedure TMainForm.LViewTeamSelectItem(Sender: TObject; Item: TListItem;
  Selected: Boolean);
Var
    Y: TListItem;
begin
    //Тут я по выбору строки справа буду показывать StringGrid игроков данной команды

    {Var X := Item.Caption;
    X := Item.SubItems.Strings[0];
    X := Item.SubItems.Strings[1];
    X := Item.SubItems.Strings[2];}


    Label1.Caption := IntToStr(ListView1.ItemIndex);
    //Var X := Item;
    Var Meow := ListView1.ItemIndex;
    Y := ListView1.Selected;
    // ListView1.Selected := nil;

    
    If Assigned(Y) then
    //If Selected Then
        BitBtn1.Enabled := True
    Else
        BitBtn1.Enabled := False;
end;

end.
